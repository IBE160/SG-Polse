<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>1</storyId>
    <title>Teacher Dashboard &amp; Course Selection</title>
    <status>drafted</status>
    <generatedAt>2025-11-28</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/3-1-teacher-dashboard-course-selection.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a teacher</asA>
    <iWant>to access a dashboard that lists the courses I teach</iWant>
    <soThat>I can select the course for which I want to manage content.</soThat>
    <tasks>
- [ ] **Backend (API)**
  - [ ] Create a tRPC procedure to fetch the list of courses assigned to the currently authenticated teacher. (AC: #1, #3)
  - [ ] This will require a relation in the database between `User` and `Course` models.
  - [ ] Add subtask for testing the procedure.
- [ ] **Frontend (UI)**
  - [ ] Create a teacher dashboard page at `/teacher/dashboard`. (AC: #1)
  - [ ] On this page, call the tRPC procedure to fetch and display the list of courses. (AC: #1)
  - [ ] Implement a UI component to display the list of courses. (AC: #2)
  - [ ] Clicking on a course should navigate to the content management page for that course (to be created in the next story). (AC: #2)
  - [ ] Add subtask for testing the dashboard UI.
- [ ] **Database**
  - [ ] Update the `schema.prisma` file to create a `Course` model and establish a many-to-many or one-to-many relationship between `User` (teachers) and `Course`.
    </tasks>
  </story>

  <acceptanceCriteria>
1. Authenticated teachers are directed to a dashboard displaying their assigned courses.
2. The teacher can select a specific course from the list.
3. Only courses assigned to the teacher are visible.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>Functional Requirements (Data &amp; Content Management)</section>
        <snippet>FR011: The system must have a mechanism to ensure the chatbot is always working with the most up-to-date information from Canvas (implies teacher management interface).</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Epic to Architecture Mapping (Epic 3)</section>
        <snippet>3. Teacher Content Management: `src/server/api/routers/`, `src/app/_components/`, Supabase Storage.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>User Journey 2: Teacher Updates Course Information</section>
        <snippet>Teacher navigates to the chatbot's administrative or upload page, authenticates, and selects the relevant course.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epics</title>
        <section>Story 3.1: Teacher Dashboard &amp; Course Selection</section>
        <snippet>As a teacher, I want to access a dashboard that lists the courses I teach, so that I can select the course for which I want to manage content.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>prisma/schema.prisma</path>
        <kind>schema</kind>
        <symbol>Course, User</symbol>
        <lines>N/A (New model and relations)</lines>
        <reason>A new `Course` model is required, and a relationship (e.g., many-to-many) needs to be established between `User` and `Course` to link teachers to their assigned courses.</reason>
      </artifact>
      <artifact>
        <path>src/server/api/routers/teacher.ts</path>
        <kind>api-router</kind>
        <symbol>teacherRouter</symbol>
        <lines>N/A (New file)</lines>
        <reason>A new tRPC router to handle teacher-specific API procedures, such as fetching assigned courses.</reason>
      </artifact>
      <artifact>
        <path>src/app/teacher/dashboard/page.tsx</path>
        <kind>page</kind>
        <symbol>TeacherDashboardPage</symbol>
        <lines>N/A (New file)</lines>
        <reason>The main page for the teacher dashboard, displaying assigned courses.</reason>
      </artifact>
      <artifact>
        <path>src/app/_components/teacher/CourseList.tsx</path>
        <kind>ui-component</kind>
        <symbol>CourseList</symbol>
        <lines>N/A (New file)</lines>
        <reason>A reusable UI component to display the list of courses a teacher is assigned to.</reason>
      </artifact>
    </code>
    <dependencies>
      <dependency ecosystem="node">
        <name>next</name>
        <version>^15.2.3</version>
        <reason>Core application framework.</reason>
      </dependency>
      <dependency ecosystem="node">
        <name>react</name>
        <version>^19.0.0</version>
        <reason>UI library for building components.</reason>
      </dependency>
      <dependency ecosystem="node">
        <name>next-auth</name>
        <version>5.0.0-beta.25</version>
        <reason>Authentication library for Next.js.</reason>
      </dependency>
      <dependency ecosystem="node">
        <name>@prisma/client</name>
        <version>^6.6.0</version>
        <reason>O/RM for database interaction.</reason>
      </dependency>
      <dependency ecosystem="node">
        <name>@trpc/server</name>
        <version>^11.0.0</version>
        <reason>Framework for creating type-safe APIs.</reason>
      </dependency>
      <dependency ecosystem="node">
        <name>zod</name>
        <version>^3.24.2</version>
        <reason>Schema validation library for tRPC inputs.</reason>
      </dependency>
      <dependency ecosystem="node">
        <name>google-gemini-generative-ai</name>
        <version>~0.0.0</version>
        <reason>Client library for interacting with the Google Gemini Large Language Model.</reason>
      </dependency>
      <dependency ecosystem="node">
        <name>zustand</name>
        <version>~0.0.0</version>
        <reason>Client-side state management library for conversation history.</reason>
      </dependency>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>The tRPC procedure for fetching assigned courses must be protected to ensure that only authenticated users with the 'TEACHER' role can access it.</constraint>
    <constraint>A clear and efficient data model must be established in `schema.prisma` to represent the relationship between `User` (teachers) and `Course` models.</constraint>
    <constraint>The teacher dashboard must only display courses actually assigned to the logged-in teacher.</constraint>
    <constraint>The UI should allow seamless navigation from the course list to a specific course's content management page.</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>Prisma Model: Course</name>
      <kind>Database Model</kind>
      <signature>
        model Course {
          id        String  @id @default(cuid())
          name      String
          teachers  User[]  @relation("TeacherCourses") // Many-to-many relation
          // Other course fields
        }
      </signature>
      <path>prisma/schema.prisma</path>
      <reason>New Prisma model to represent courses, including a relation to teachers.</reason>
    </interface>
    <interface>
      <name>Prisma Model: User (Modified)</name>
      <kind>Database Model</kind>
      <signature>
        model User {
          // ... existing fields
          teachingCourses Course[] @relation("TeacherCourses") // Many-to-many relation
        }
      </signature>
      <path>prisma/schema.prisma</path>
      <reason>Modification to the User model to reflect the many-to-many relationship with courses.</reason>
    </interface>
    <interface>
      <name>Fetch Teacher Courses tRPC Procedure</name>
      <kind>tRPC-procedure</kind>
      <signature>
        getTeacherCourses: teacherProcedure
          .query(async ({ ctx }) => {
            // Logic to fetch courses assigned to ctx.session.user.id
            // Assumes ctx.session.user.id is available and user is a teacher
            return Array<Course>;
          });
      </signature>
      <path>src/server/api/routers/teacher.ts</path>
      <reason>API for fetching the list of courses assigned to the authenticated teacher.</reason>
    </interface>
  </interfaces>
  <tests>
    <standards>
      A pragmatic testing approach will be used.
      - **Unit Tests:** Jest and React Testing Library will be used for unit testing critical UI components and business logic.
      - **Integration Tests:** Integration tests will be written for tRPC API procedures to ensure they interact with the database correctly.
    </standards>
    <locations>
      Test files should be co-located with the source files they are testing (e.g., `MyComponent.tsx` and `MyComponent.test.tsx` in the same folder).
    </locations>
    <ideas>
      <idea for="AC1">Write an end-to-end test to verify that an authenticated teacher user is successfully directed to `/teacher/dashboard` and sees a list of courses they are assigned to.</idea>
      <idea for="AC2">Write a unit test for the `CourseList` component to ensure it correctly renders and allows selection of courses, and triggers navigation to a course-specific content management page upon selection.</idea>
      <idea for="AC3">Write an integration test for the `getTeacherCourses` tRPC procedure, verifying that it fetches only the courses assigned to the authenticated teacher and correctly handles cases where a teacher has no assigned courses.</idea>
      <idea for="Database">Implement a database migration test to confirm that the `Course` model and its relationships to the `User` model are correctly defined and applied in the Prisma schema.</idea>
    </ideas>
  </tests>
</story-context>
